<div class="dashboard-container">
  <div class="dashboard-content">
    <section class="stats-section">
      <mat-card class="stats-card">
        <mat-card-content>
          <div class="stats-grid">
            <div class="stat-item">
              <mat-icon>event</mat-icon>
              <div class="stat-info">
                <span class="stat-value">{{ eventStats.totalEvents }}</span>
                <span class="stat-label">Total Events</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>upcoming</mat-icon>
              <div class="stat-info">
                <span class="stat-value">{{ eventStats.upcomingEvents }}</span>
                <span class="stat-label">Upcoming</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>check_circle</mat-icon>
              <div class="stat-info">
                <span class="stat-value">{{ eventStats.completedEvents }}</span>
                <span class="stat-label">Completed</span>
              </div>
            </div>
            <div class="stat-item">
              <mat-icon>attach_money</mat-icon>
              <div class="stat-info">
                <span class="stat-value">{{ formatCurrency(eventStats.totalSpent) }}</span>
                <span class="stat-label">Total Spent</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Monthly Stats -->
      <mat-card class="monthly-stats-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>bar_chart</mat-icon>
            Monthly Overview
          </mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="monthly-stats-container">
            <div class="monthly-chart">
              <div class="chart-bars">
                <div *ngFor="let stat of monthlyStats" class="chart-bar-container">
                  <div class="chart-bar" [style.height]="getBarHeight(stat.spending) + '%'">
                    <span class="bar-value">{{ formatCurrency(stat.spending) }}</span>
                  </div>
                  <span class="bar-label">{{ stat.month }}</span>
                </div>
              </div>
            </div>
            <div class="monthly-stats-summary">
              <div class="summary-item">
                <span class="summary-label">Total Events</span>
                <span class="summary-value">{{ getTotalEvents() }}</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Total Spending</span>
                <span class="summary-value">{{ formatCurrency(getTotalSpending()) }}</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Average per Month</span>
                <span class="summary-value">{{ formatCurrency(getAverageSpending()) }}</span>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </section>

    <section class="calendar-events-section">
      <div class="calendar-container">
        <mat-card>
          <mat-card-header>
            <mat-card-title>
              <mat-icon>calendar_today</mat-icon>
              Your Events Calendar
              <button mat-button color="primary" (click)="goToToday()" class="today-button">
                <mat-icon>today</mat-icon>
                Today
              </button>
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-calendar
              #calendar
              [selected]="selectedDate"
              (selectedChange)="onDateSelected($event)"
              [dateClass]="hasEventsOnDate"
              [minDate]="minDate"
              [maxDate]="maxDate"
              class="custom-calendar"
              tabindex="0">
            </mat-calendar>
          </mat-card-content>
        </mat-card>

        <!-- Upcoming Events Preview -->
        <mat-card class="upcoming-events-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>upcoming</mat-icon>
              Upcoming Events
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-list>
              <mat-list-item *ngFor="let event of upcomingEventsPreview">
                <mat-icon matListItemIcon [style.color]="getCategoryColor(event.eventDetails.category)">
                  {{ getCategoryIcon(event.eventDetails.category) }}
                </mat-icon>
                <div matListItemTitle>{{ event.eventDetails.title }}</div>
                <div matListItemLine>{{ formatDate(event.eventDetails.date) }}</div>
              </mat-list-item>
            </mat-list>
          </mat-card-content>
        </mat-card>

        <!-- Recent Activity -->
        <mat-card class="recent-activity-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>history</mat-icon>
              Recent Activity
            </mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-list>
              <mat-list-item *ngFor="let activity of recentActivity">
                <mat-icon matListItemIcon [style.color]="getActivityColor(activity.type)">
                  {{ getActivityIcon(activity.type) }}
                </mat-icon>
                <div matListItemTitle>{{ activity.event.eventDetails.title }}</div>
                <div matListItemLine>
                  {{ activity.type | titlecase }} on {{ formatDate(activity.date) }}
                </div>
              </mat-list-item>
            </mat-list>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="events-container">
        <mat-card>
          <mat-card-header>
            <mat-card-title>
              <mat-icon>event</mat-icon>
              Scheduled Events
              <span *ngIf="isDateFiltered" class="date-filter-info">
                {{ selectedDate | date:'mediumDate' }}
                <button mat-mini-fab color="warn" (click)="clearDateFilter()" matTooltip="Clear date filter" class="clear-filter-btn">
                  <mat-icon>filter_alt_off</mat-icon>
                </button>
              </span>
            </mat-card-title>
            <div class="category-filter">
              <button mat-raised-button
                *ngFor="let category of categories"
                [class.active]="selectedCategory === category"
                (click)="filterEventsByCategory(category)">
                {{ category }}
              </button>
            </div>
          </mat-card-header>
          <mat-card-content>
            <div class="events-list">
              <mat-card *ngFor="let event of getPaginatedEvents()" class="event-card">
                <mat-card-header>
                  <mat-card-title>{{ event.eventDetails.title }}</mat-card-title>
                  <mat-card-subtitle>
                    <span class="event-status" [class]="getEventStatusClass(event.status)">
                      <mat-icon>{{ getStatusIcon(event.status) }}</mat-icon>
                      <span class="status-text">{{ event.status | titlecase }}</span>
                    </span>
                  </mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="event-info">
                    <p>
                      <mat-icon>calendar_month</mat-icon>
                      {{ formatDate(event.eventDetails.date) }}
                    </p>
                    <p>
                      <mat-icon>schedule</mat-icon>
                      {{ formatTime(event.eventDetails.date) }}
                    </p>
                    <p>
                      <mat-icon>place</mat-icon>
                        {{ event.eventDetails.location }}
                    </p>
                    <p>
                      <mat-icon>payments</mat-icon>
                      {{ formatCurrency(event.eventDetails.price) }}
                    </p>
                    <p>
                      <mat-icon>label</mat-icon>
                      {{ event.eventDetails.category }}
                    </p>
                    <p>
                      <mat-icon>business</mat-icon>
                      {{ event.eventDetails.organizer }}
                    </p>
                  </div>
                  <p class="event-description">{{ event.eventDetails.description }}</p>
                </mat-card-content>
                <mat-card-actions>
                  <button mat-raised-button color="primary" [routerLink]="['/events', event.eventDetails.id]">
                    <mat-icon>visibility</mat-icon>
                    View Details
                  </button>
                  <button mat-raised-button color="warn" *ngIf="event.status === 'booked'" (click)="cancelEvent(event)">
                    <mat-icon>cancel</mat-icon>
                    Cancel Booking
                  </button>
                </mat-card-actions>
              </mat-card>
            </div>

            <div class="pagination-controls">
              <button mat-button (click)="previousPage()" [disabled]="currentPage === 1">
                <mat-icon>chevron_left</mat-icon>
                Previous
              </button>
              <span class="pagination-info">
                Page {{ currentPage }} of {{ totalPages }}
              </span>
              <button mat-button (click)="nextPage()" [disabled]="currentPage === totalPages">
                Next
                <mat-icon>chevron_right</mat-icon>
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </section>
  </div>
</div> 