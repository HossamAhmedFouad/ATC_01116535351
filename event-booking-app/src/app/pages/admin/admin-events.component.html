<div class="admin-container">
  <div class="admin-layout">
    <!-- Header Section -->
    <header class="admin-header">
      <div>
        <h1>Event Management</h1>
        <p class="subtitle">
          Manage your events, track registrations, and monitor performance
        </p>
      </div>
      <button class="action-button primary" (click)="openEventModal()">
        <mat-icon>add</mat-icon> Create New Event
      </button>
    </header>

    <!-- Dashboard Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-title">Total Events</div>
          <div class="stat-icon-wrapper primary">
            <mat-icon>event</mat-icon>
          </div>
        </div>
        <div class="stat-value">{{ events.length }}</div>
        <div class="stat-description">
          <mat-icon class="trending-up">trending_up</mat-icon>
          <span>5% increase this month</span>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-title">Active Events</div>
          <div class="stat-icon-wrapper success">
            <mat-icon>event_available</mat-icon>
          </div>
        </div>
        <div class="stat-value">{{ getEventCountByStatus("active") }}</div>
        <div class="stat-description">
          <span>Currently active and bookable</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-header">
          <div class="stat-title">Inactive Events</div>
          <div class="stat-icon-wrapper danger">
            <mat-icon>event_busy</mat-icon>
          </div>
        </div>
        <div class="stat-value">{{ getEventCountByStatus("inactive") }}</div>
        <div class="stat-description">
          <span>Currently unavailable events</span>
        </div>
      </div>
    </div>
    <!-- Filters Section -->
    <div class="filters-section">
      <div class="filters-title">
        <mat-icon>filter_list</mat-icon>
        <span>Filter Events</span>
      </div>
      <div class="filters-container">
        <app-search-bar
          [searchText]="searchTerm"
          (searchTextChange)="onSearchChange($event)"
          placeholder="Search events by title, location, or description..."
        ></app-search-bar>

        <div class="filter-options">
          <div class="filter-group">
            <label class="filter-label">Status</label>
            <select
              class="filter-select"
              [(ngModel)]="filterStatus"
              (change)="filterEvents()"
            >
              <option value="all">All Status</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>
          <div class="filter-group">
            <label class="filter-label">Date Range</label>
            <div class="date-range-selector">
              <select
                class="filter-select date-preset"
                [(ngModel)]="dateRangePreset"
                (change)="applyDateRangePreset()"
              >
                <option value="all">All Dates</option>
                <option value="today">Today</option>
                <option value="yesterday">Yesterday</option>
                <option value="thisWeek">This Week</option>
                <option value="lastWeek">Last Week</option>
                <option value="thisMonth">This Month</option>
                <option value="lastMonth">Last Month</option>
                <option value="custom">Custom Range</option>
              </select>
            </div>
            <div class="date-filter" *ngIf="dateRangePreset === 'custom'">
              <input
                type="date"
                class="filter-input"
                [(ngModel)]="startDate"
                (change)="filterEvents()"
              />
              <span>to</span>
              <input
                type="date"
                class="filter-input"
                [(ngModel)]="endDate"
                (change)="filterEvents()"
              />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Events Table -->
    <div class="table-section">
      <div class="table-header">
        <div class="table-title">
          <mat-icon>list</mat-icon>
          <span>Event List</span>
        </div>
        <div class="table-actions">
          <!-- Bulk actions dropdown -->
          <div class="bulk-actions" *ngIf="selectedEvents.length > 0">
            <select class="action-select" [(ngModel)]="bulkAction">
              <option value="" disabled selected></option>
              <option disabled selected value="">
                Bulk Actions ({{ selectedEvents.length }} selected)
              </option>
              <option value="setActive">Set Status: Active</option>
              <option value="setInactive">Set Status: Inactive</option>
              <option value="delete">Delete Selected</option>
            </select>
            <button
              class="action-button danger-outline"
              (click)="applyBulkAction()"
            >
              Apply
            </button>
          </div>

          <button class="action-button secondary" (click)="exportEvents()">
            <mat-icon>file_download</mat-icon>
            Export
          </button>
        </div>
      </div>
      <div class="table-container">
        <!-- Show loader when loading data -->
        <app-loader
          *ngIf="isLoading"
          [message]="'Loading events...'"
        ></app-loader>

        <!-- Show empty state when no events match filters -->
        <div
          class="empty-state"
          *ngIf="!isLoading && filteredEvents.length === 0"
        >
          <mat-icon>event_busy</mat-icon>
          <h3>No events found</h3>
          <p>Try adjusting your filters or create a new event.</p>
        </div>

        <table
          class="events-table"
          *ngIf="!isLoading && filteredEvents.length > 0"
        >
          <thead>
            <tr>
              <th class="select-column">
                <input
                  type="checkbox"
                  [checked]="isAllSelected()"
                  (change)="toggleAllSelection()"
                />
              </th>
              <th (click)="sortBy('id')" class="sortable">
                ID
                <mat-icon>{{
                  sortColumn === "id"
                    ? sortDirection === "asc"
                      ? "arrow_upward"
                      : "arrow_downward"
                    : "unfold_more"
                }}</mat-icon>
              </th>
              <th (click)="sortBy('title')" class="sortable">
                Event Title
                <mat-icon>{{
                  sortColumn === "title"
                    ? sortDirection === "asc"
                      ? "arrow_upward"
                      : "arrow_downward"
                    : "unfold_more"
                }}</mat-icon>
              </th>
              <th (click)="sortBy('date')" class="sortable">
                Date
                <mat-icon>{{
                  sortColumn === "date"
                    ? sortDirection === "asc"
                      ? "arrow_upward"
                      : "arrow_downward"
                    : "unfold_more"
                }}</mat-icon>
              </th>
              <th (click)="sortBy('location')" class="sortable">
                Location
                <mat-icon>{{
                  sortColumn === "location"
                    ? sortDirection === "asc"
                      ? "arrow_upward"
                      : "arrow_downward"
                    : "unfold_more"
                }}</mat-icon>
              </th>
              <th (click)="sortBy('status')" class="sortable">
                Status
                <mat-icon>{{
                  sortColumn === "status"
                    ? sortDirection === "asc"
                      ? "arrow_upward"
                      : "arrow_downward"
                    : "unfold_more"
                }}</mat-icon>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let event of filteredEvents"
              [class.selected-row]="isEventSelected(event)"
            >
              <td class="select-column">
                <input
                  type="checkbox"
                  [checked]="isEventSelected(event)"
                  (change)="toggleEventSelection(event)"
                />
              </td>
              <td [title]="event.id">{{ event.id }}</td>
              <td [title]="event.title">{{ event.title }}</td>
              <td [title]="event.date | date : 'mediumDate'">
                {{ event.date | date : "mediumDate" }}
                <span *ngIf="event.time" class="time-display">{{
                  event.time
                }}</span>
              </td>
              <td [title]="event.location">{{ event.location }}</td>
              <td>
                <span
                  class="status-badge"
                  [class.active]="event.status === 'active'"
                  [class.inactive]="event.status === 'inactive'"
                >
                  <mat-icon *ngIf="event.status === 'active'"
                    >check_circle</mat-icon
                  >
                  <mat-icon *ngIf="event.status === 'inactive'"
                    >cancel</mat-icon
                  >
                  {{ event.status }}
                </span>
              </td>
              <td class="actions-cell">
                <button
                  class="btn-icon view"
                  (click)="viewEvent(event)"
                  title="View Event"
                >
                  <mat-icon>visibility</mat-icon>
                </button>
                <button
                  class="btn-icon edit"
                  (click)="editEvent(event)"
                  title="Edit Event"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  class="btn-icon delete"
                  (click)="confirmDelete(event)"
                  title="Delete Event"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="empty-state" *ngIf="filteredEvents.length === 0">
          <mat-icon>event_busy</mat-icon>
          <h3>No events found</h3>
          <p>Try adjusting your filters or create a new event</p>
          <button class="action-button primary" (click)="openEventModal()">
            <mat-icon>add</mat-icon> Create New Event
          </button>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination">
        <button
          [disabled]="currentPage === 1"
          (click)="goToPage(currentPage - 1)"
        >
          <mat-icon>chevron_left</mat-icon>
        </button>

        <div class="page-numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            [class.active]="page === currentPage"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        </div>

        <button
          [disabled]="currentPage === totalPages"
          (click)="goToPage(currentPage + 1)"
        >
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Event Modal -->
  <div class="modal-backdrop" *ngIf="showEventModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">
          {{ isEditMode ? "Edit Event" : "Create New Event" }}
        </h2>
        <button class="modal-close" (click)="closeEventModal()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="modal-body">
        <form [formGroup]="eventForm" (ngSubmit)="saveEvent()">
          <div class="form-group">
            <label class="form-label" for="title">Event Title</label>
            <input
              type="text"
              id="title"
              class="form-control"
              formControlName="title"
              placeholder="Enter event title"
            />
            <div
              class="form-error"
              *ngIf="
                eventForm.get('title')?.invalid &&
                eventForm.get('title')?.touched
              "
            >
              Event title is required
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="date">Event Date</label>
              <input
                type="date"
                id="date"
                class="form-control"
                formControlName="date"
              />
              <div
                class="form-error"
                *ngIf="
                  eventForm.get('date')?.invalid &&
                  eventForm.get('date')?.touched
                "
              >
                Valid date is required
              </div>
            </div>

            <div class="form-group">
              <label class="form-label" for="time">Event Time</label>
              <input
                type="time"
                id="time"
                class="form-control"
                formControlName="time"
              />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="location">Location</label>
            <input
              type="text"
              id="location"
              class="form-control"
              formControlName="location"
              placeholder="Enter event location"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="description">Description</label>
            <textarea
              id="description"
              class="form-control"
              formControlName="description"
              rows="4"
              placeholder="Enter event description"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="status">Status</label>
              <select id="status" class="form-control" formControlName="status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="capacity">Capacity</label>
              <input
                type="number"
                id="capacity"
                class="form-control"
                formControlName="capacity"
                min="1"
                placeholder="Number of attendees"
              />
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="image">Image URL</label>
            <input
              type="text"
              id="image"
              class="form-control"
              formControlName="image"
              placeholder="Enter image URL"
            />
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="closeEventModal()"
        >
          <mat-icon>close</mat-icon> Cancel
        </button>
        <button
          type="button"
          class="btn btn-primary"
          [disabled]="eventForm.invalid"
          (click)="saveEvent()"
        >
          <mat-icon>save</mat-icon>
          {{ isEditMode ? "Update Event" : "Create Event" }}
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-backdrop" *ngIf="showDeleteModal">
    <div class="modal-content delete-modal">
      <div class="modal-header">
        <h2 class="modal-title">Confirm Delete</h2>
        <button class="modal-close" (click)="cancelDelete()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="modal-body">
        <mat-icon class="delete-icon">warning</mat-icon>
        <h3>Are you sure you want to delete this event?</h3>
        <p>{{ eventToDelete?.title }}</p>
        <p class="warning-text">This action cannot be undone.</p>
      </div>

      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="cancelDelete()"
        >
          <mat-icon>cancel</mat-icon> Cancel
        </button>
        <button type="button" class="btn btn-danger" (click)="deleteEvent()">
          <mat-icon>delete</mat-icon> Delete Event
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container">
    <div
      class="toast"
      *ngFor="let toast of toasts"
      [class.success]="toast.type === 'success'"
      [class.error]="toast.type === 'error'"
      [class.info]="toast.type === 'info'"
      [class.warning]="toast.type === 'warning'"
    >
      <div class="toast-content">
        <mat-icon [class]="toast.type">
          {{ getToastIcon(toast.type) }}
        </mat-icon>
        <div>{{ toast.message }}</div>
      </div>
      <button class="toast-close" (click)="removeToast(toast)">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
</div>
